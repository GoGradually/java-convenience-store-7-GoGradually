# java-convenience-store-precourse

# 기능 요구사항
- 결제 시스템
- 재고 관리
- 프로모션 할인
- 멤버십 할인
- 영수증 출력

# State Diagram
```mermaid
graph
    promotion등록 --> 재고추가
    재고추가-->재고보기
    재고보기-->아이템구입_호출
    아이템구입_호출-->아이템구입_검사
    아이템구입_검사-->프로모션할인
    프로모션할인-->판매큐_등록
    판매큐_등록-->프로모션할인
    판매큐_등록-->멤버십할인
    멤버십할인-->판매
    판매-->영수증출력
    영수증출력-->재이용여부
    재이용여부-->재고보기
    재이용여부-->종료
```

# 기능 목록 & 기능 우선순위
- [x] 프로모션 등록
  - 사전조건
    - 애플리케이션이 시작될 때 실행되어야 한다
  - 사후조건
    - 등록된 프로모션을 문자열을 통해 빠르게 탐색할 수 있어야 한다.
- [x] 재고 추가
  - 사전조건
    - 프로모션이 등록되어 있어야 한다
  - 사후조건
    - 아이템 별로 프로모션이 가능하다면, 프로모션이 등록되어있어야 한다
    - 아이템 별로 문자열로 검색하면, 해당 아이템 객체를 받아올 수 있어야 한다.
- [ ] 프로모션할인
  - 사전조건
    - 구매하고자 하는 아이템이 입력으로 들어와야 한다
  - 사후조건
    - 재고가 모자란 경우, 사용자가 물품을 덜 들고온 경우, 프로모션이 없는 경우가 모두 정상적으로 처리되어야 한다
- [ ] 아이템구입_검사
  - 사전조건
    - 아이템 구입 메소드가 정상적으로 반환한 리스트를 받아야 한다.
  - 사후조건
    - 각 아이템들의 재고가 충분한 상태에만 정상적으로 반환되어야 한다.
- [ ] 재고 보기
  - 사전조건
    - 재고가 추가된 상태여야 한다
  - 사후조건
    - 없음
- [ ] 멤버십 할인
  - 사전조건
    - 모든 구매 물품에 대한 프로모션 할인 적용 여부가 결정되어야 한다.
  - 사후조건
    - 멤버십 할인이 적용될 가격이 출력으로 주어져야 한다
- [ ] 아이템구입_호출
  - 사전조건
    - 재고가 보여진 상태에서 호출되어야 한다.
  - 사후조건
    - 구입하고자 하는 아이템들이 반환되어야 한다.
- [ ] 판매
  - 사전조건
    - 판매되어야 하는 재고와 그 가격들이 모두 완성되어야 한다.
  - 사후조건
    - 재고가 구매물품의 수량만큼 감소해야 한다.
- [ ] 영수증 출력
  - 사전조건
    - 판매된 재고와 그 가격, 할인된 가격이 입력으로 주어져야 한다
  - 사후조건
    - 영수증을 출력한다
- [ ] 재이용 여부 확인
  - 사전조건
    - 영수증 출력이 완료되어야 한다.
  - 사후조건
    - 재이용 여부에 따라, 종료 상태 혹은 재고 보기 상태로 이동해야 한다.



# 커스텀 기능 요구사항
- 구입 과정 도중 예외가 발생할 경우, 재고가 소진되지 않고 결제 처리가 되지 않아야 한다.
- 프로모션은 상품 종류당 최대 하나만 적용 가능하다고 가정한다.

# 리스크 팩터
- 프로모션이 적용된 물품과 적용 안된 물품 사이 가격 계산을 어떻게 하지?
  - 최종적으로 적용된 물품 갯수만 반환하도록 만들기
  - 가격 계산은 Cashier 가 담당하도록 구현
- 상품 출력을 어떻게 접근하지?
  - getter 로 다 열어두는건 매우 위험하다.
  - DTO로 데이터를 적절히 전달하는 방식으로 변경하자.
- 추가 수량이 부족한 경우는 어떻게 하지?
  - 필요로 하는 양이 모자르면 그 이후 갯수 빼서 출력하기
  - 무조건 정렬된 프로모션 순서순으로 판매됨 -> 비 프로모션을 아끼지 않음
  - 추가 수량이 있는데 프로모션 재고가 모자를 경우, 프로모션이 적용되지 않는 수량을 알 수 있어야 함
  - 프로모션 할인불가능 -> 프로모션 미적용 상품으로만 구매되지 않을 경우 검사
  - 계산 순서가 전체 수량 검사 -> 프로모션 할인불가능 검사 -> 프로모션 추가 가능 검사 -> 프로모션 적용 순으로 해야 조건문이 깔끔하다
- 문자열 파싱은 어떤 방식으로 처리하지?
  - 뭘 예외로 하고, 뭘 정상으로 처리하지?
    - '[', ']', '-', ',' 를 제외한 모든 문자 사용 가능
    - 빈 문자열 or null 불가능
- 멤버십 할인 계산을 어떻게 하지?
  - 프로모션 적용 상품과 프로모션 미적용 상품 구분 -> 프로모션 혜택 0개이면
  - 리스트로 프로모션 적용/미적용 구분하기

# 우선순위 낮은 고려사항